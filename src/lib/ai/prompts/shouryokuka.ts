import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<
  string,
  (profile: BusinessProfile, context?: string) => string
> = {
  business_overview: (profile, context) =>
    `あなたは中小企業診断士として、中小企業省力化投資補助金の事業計画書の「事業概要と人手不足の現状」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 現在の事業内容と従業員数を簡潔に示す
2. 人手不足の実態を具体的に記述する（どの業務で何人分が不足しているか）
3. 人手不足が事業に与えている影響（残業時間・機会損失・品質低下等）を数値で示す
4. 人手不足解消の緊急性・重要性を審査員が理解できるよう記述する
5. 400-600字程度で記述する

## 審査のポイント
省力化補助金では「人手不足の深刻さ」と「省力化の必要性」が重視されます。定性的な表現だけでなく、具体的な数字（残業時間、欠員数、売上機会損失額等）を用いて現状の深刻さを客観的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  labor_saving_plan: (profile, context) =>
    `あなたは中小企業診断士として、中小企業省力化投資補助金の事業計画書の「省力化計画と導入製品の概要」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 導入する省力化製品の機能・仕様を具体的に説明する
2. なぜその製品を選んだか（自社の課題への適合性、他製品との比較）を記述する
3. 導入後の業務フローの変化（導入前→導入後の比較）を示す
4. 省力化製品の導入によって自動化・効率化される具体的な業務を列挙する
5. 600-800字程度で記述する

## 審査のポイント
カタログ掲載製品の選定理由と自社業務への適合性が評価されます。「なぜこの製品でなければならないか」を具体的に示し、導入後の業務フロー改善を視覚的に理解できるよう記述してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  equipment_details: (profile, context) =>
    `あなたは中小企業診断士として、中小企業省力化投資補助金の事業計画書の「導入設備の詳細と費用計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 導入する省力化製品の型番・仕様・数量を明記する
2. 補助対象経費の内訳（製品費・設置費・導入支援費等）を記載する
3. 補助金申請額と自己負担額を明確に示す
4. 費用の妥当性（相場との比較、費用対効果）に触れる
5. 300-500字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  effect_forecast: (profile, context) =>
    `あなたは中小企業診断士として、中小企業省力化投資補助金の事業計画書の「省力化効果と生産性向上の見通し」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 労働時間削減効果を具体的な数値で示す（例: 月○時間削減、年間○人分の省力化）
2. 生産性向上効果（処理能力向上率、コスト削減額等）を定量的に記述する
3. 省力化によって生まれた時間・リソースの活用方法（新業務への転換等）を示す
4. 売上・利益への波及効果（定量・定性）を記載する
5. 効果の達成見込み時期を明記する
6. 400-600字程度で記述する

## 審査のポイント
省力化効果の定量的根拠が審査で重視されます。「〇〇時間削減」「〇〇万円コスト削減」など具体的な数値を用い、その算出根拠も簡潔に説明してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  implementation_schedule: (profile, context) =>
    `あなたは中小企業診断士として、中小企業省力化投資補助金の事業計画書の「実施スケジュールと体制」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 補助金交付決定後から事業完了までの月次スケジュールを記述する
2. 発注・納品・設置・試運転・本稼働の各工程と担当者を明記する
3. 登録事業者（販売店）との連携体制を説明する
4. 200-400字程度で簡潔に記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};

export function getShouryokukaPrompt(
  sectionKey: string,
  profile: BusinessProfile,
  additionalContext?: string
): string {
  const builder = PROMPTS[sectionKey];
  if (!builder) {
    throw new Error(`Unknown shouryokuka section key: ${sectionKey}`);
  }
  return builder(profile, additionalContext);
}
