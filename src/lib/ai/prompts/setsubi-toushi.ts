import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<
  string,
  (profile: BusinessProfile, context?: string) => string
> = {
  company_strength: (profile, context) =>
    `あなたは中小企業診断士として、設備投資支援事業の事業計画書の「自社の強みと事業環境」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 自社の事業概要と主力製品・サービスを簡潔に紹介する
2. 技術力・品質管理・顧客対応等の具体的な強みを示す
3. 現在の事業環境の変化（市場動向、技術革新、顧客ニーズの変化等）を分析する
4. 事業環境の変化に対応するための課題を明確にする
5. 設備投資が必要な背景を論理的に説明する
6. 600〜800字程度で記述する

## 審査のポイント
設備投資支援では「なぜ今この投資が必要か」が重要です。単に古い設備を更新するのではなく、事業環境の変化に対応し競争力を強化するための戦略的投資であることを示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  investment_plan: (profile, context) =>
    `あなたは中小企業診断士として、設備投資支援事業の事業計画書の「設備投資の内容と目的」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 導入する設備の名称・仕様・メーカー・数量を具体的に記載する
2. なぜその設備を選定したか（性能比較、費用対効果、導入実績等）の理由を示す
3. 投資目的を明確にする（競争力強化・DX推進・生産性向上・品質向上等）
4. 現有設備との比較（スペック差、処理能力差、品質差等）を数値で示す
5. 設備投資額の内訳と補助金申請額を明記する
6. 費用の妥当性（複数見積り、相場との比較）に触れる
7. 800〜1200字程度で記述する

## 審査のポイント
設備の選定理由と投資額の妥当性が厳しく審査されます。「最新設備だから」ではなく、自社の課題解決にどう直結するかを具体的に示し、他の選択肢と比較した上での合理的な判断であることを説明してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  implementation_schedule: (profile, context) =>
    `あなたは中小企業診断士として、設備投資支援事業の事業計画書の「実施スケジュールと体制」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 設備導入から本格稼働までの月次スケジュールを記述する
2. 各フェーズの内容を明記する（発注→納品→設置工事→試運転→本稼働→効果検証）
3. 運用体制（設備の操作担当者、管理責任者、保守体制）を示す
4. 従業員への教育訓練計画（研修内容、期間、対象者数）を記載する
5. 外部ベンダーとの連携体制（導入支援、保守契約等）に触れる
6. 400〜600字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  business_impact: (profile, context) =>
    `あなたは中小企業診断士として、設備投資支援事業の事業計画書の「投資効果と成長戦略」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 定量的な投資効果を具体的に示す（生産性○%向上、コスト○万円削減、売上○%増加等）
2. 効果の算出根拠を明記する（現状の処理能力→導入後の処理能力、等）
3. 定性的な効果（品質向上、納期短縮、新規顧客開拓、従業員の負担軽減等）も記述する
4. 中長期的な成長戦略（3〜5年の事業展望）との関連を示す
5. 投資回収の見込み（投資額÷年間効果額）を明記する
6. 効果の測定方法・KPI を示す
7. 600〜800字程度で記述する

## 審査のポイント
投資効果の定量的な根拠が最も重視されます。「生産性が向上する」という定性的表現だけでなく、「処理能力が月○個から○個に増加し、売上○万円の増加が見込める」等の具体的数値と算出根拠を示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};

export function getSetsubiToushiPrompt(
  sectionKey: string,
  profile: BusinessProfile,
  additionalContext?: string
): string {
  const builder = PROMPTS[sectionKey];
  if (!builder) {
    throw new Error(`Unknown setsubi-toushi section key: ${sectionKey}`);
  }
  return builder(profile, additionalContext);
}
