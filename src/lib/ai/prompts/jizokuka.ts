import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<string, (profile: BusinessProfile, context?: string) => string> = {
  company_overview: (profile, context) => `あなたは中小企業診断士として、小規模事業者持続化補助金の経営計画書（様式2）の「1. 企業概要」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 審査員が「この事業者は自社の状況をしっかり把握している」と感じる記述にする
2. 具体的な数字（売上、顧客数、取扱商品数など）を可能な限り含める
3. 業界用語を適度に使い、専門性を示す
4. 800-1200字程度で記述する
5. 箇条書きと文章を組み合わせて読みやすくする

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  customer_needs_market: (profile, context) => `あなたは中小企業診断士として、小規模事業者持続化補助金の経営計画書（様式2）の「2. 顧客ニーズと市場の動向」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 顧客ニーズを具体的に分析する（何を求めているか、どのような課題を抱えているか）
2. 市場規模や成長トレンドについて言及する（業界データがあれば引用）
3. 競合他社の状況と差別化ポイントを明確にする
4. PEST分析やSWOT分析の要素を自然に組み込む
5. 800-1200字程度で記述する

## 出力形式
セクション本文をそのまま出力してください。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  strengths: (profile, context) => `あなたは中小企業診断士として、小規模事業者持続化補助金の経営計画書（様式2）の「3. 自社や自社の提供する商品・サービスの強み」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 競合と比較した明確な差別化要素を示す
2. 顧客にとっての具体的なメリットを記述する
3. 数値で裏付けられる強み（リピート率、満足度等）を含める
4. 技術面・サービス面・ブランド面の強みを網羅する
5. 600-1000字程度で記述する

## 出力形式
セクション本文をそのまま出力してください。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  management_plan: (profile, context) => `あなたは中小企業診断士として、小規模事業者持続化補助金の経営計画書（様式2）の「4. 経営方針・目標と今後のプラン」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 経営方針を明確に示す（ミッション・ビジョン）
2. 数値目標を含める（売上目標、顧客数目標、利益率等）
3. 3-5年の中長期プランを示す
4. 具体的なアクションプラン（いつ・何を・どのように）を記述
5. 前のセクション（企業概要、顧客ニーズ、強み）との一貫性を保つ
6. 800-1200字程度で記述する

## 出力形式
セクション本文をそのまま出力してください。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  project_name: (profile, context) => `小規模事業者持続化補助金の補助事業計画書（様式3）の「1. 補助事業で行う事業名」を作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 30文字以内で簡潔に
2. 何をするのかが一目でわかるタイトル
3. 3つの候補を提示してください

## 出力形式
候補1: ○○○○
候補2: ○○○○
候補3: ○○○○`,

  sales_expansion_plan: (profile, context) => `あなたは中小企業診断士として、小規模事業者持続化補助金の補助事業計画書（様式3）の「2. 販路開拓等の取組内容」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 具体的な取り組み内容を詳細に記述する
2. 実施スケジュール（何月に何をするか）を含める
3. 必要な経費の内訳と根拠を示す
4. 他の取り組みとの相乗効果に言及する
5. 1000-1500字程度で記述する
6. 審査員が「実現可能性が高い」と判断できる具体性を持たせる

## 出力形式
セクション本文をそのまま出力してください。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  efficiency_plan: (profile, context) => `あなたは中小企業診断士として、小規模事業者持続化補助金の補助事業計画書（様式3）の「3. 業務効率化（生産性向上）の取組内容」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 現状の業務プロセスと課題を明示する
2. 導入するツール・手法を具体的に記述する
3. 効率化による時間削減・コスト削減の見込みを数値で示す
4. 600-1000字程度で記述する

## 出力形式
セクション本文をそのまま出力してください。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  expected_effects: (profile, context) => `あなたは中小企業診断士として、小規模事業者持続化補助金の補助事業計画書（様式3）の「4. 補助事業の効果」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 定量的な効果（売上増加率、新規顧客数、コスト削減額）を具体的に示す
2. 定性的な効果（ブランド認知向上、顧客満足度向上等）も記述する
3. 効果の測定方法を明示する
4. 補助事業終了後の持続性を示す
5. 600-1000字程度で記述する

## 出力形式
セクション本文をそのまま出力してください。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};

export function getJizokukaPrompt(
  sectionKey: string,
  profile: BusinessProfile,
  additionalContext?: string
): string {
  const builder = PROMPTS[sectionKey];
  if (!builder) {
    throw new Error(`Unknown section key: ${sectionKey}`);
  }
  return builder(profile, additionalContext);
}
