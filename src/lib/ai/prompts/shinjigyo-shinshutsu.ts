import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<
  string,
  (profile: BusinessProfile, context?: string) => string
> = {
  business_overview: (profile, context) =>
    `あなたは中小企業診断士として、中小企業新事業進出補助金の事業計画書の「現在の事業概要と経営資源」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 現在の事業内容、主要製品・サービス、顧客基盤を明確に示す
2. 新事業進出の基盤となる強み・技術・ノウハウ・設備等を具体的に列挙する
3. 直近3年の業績推移（売上・利益の傾向）と市場環境の変化に触れる
4. 新事業進出に取り組む背景・動機を経営的観点から記述する
5. 500-700字程度で記述する

## 審査のポイント
「既存経営資源の活用可能性」が重要な審査観点です。自社が保有する資産（有形・無形）が新事業でどのように活かせるかを明確に示し、単なる新規参入ではなく自社の強みを活かした展開であることを強調してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  new_business_plan: (profile, context) =>
    `あなたは中小企業診断士として、中小企業新事業進出補助金の事業計画書の「新事業進出の計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 進出する新事業の概要（新製品・新サービス・新市場）を具体的に記述する
2. 既存事業との違い（新規性・革新性）を明確に示す
3. 既存の経営資源（技術・設備・ノウハウ・顧客基盤）をどう活用するかを説明する
4. 新事業実現に向けた具体的な取り組み内容（開発・設備導入・販路開拓等）を記述する
5. なぜ今このタイミングで新事業進出が必要かを説明する
6. 800-1200字程度で記述する

## 審査のポイント
「事業の新規性」と「既存経営資源との連続性」の両立が評価されます。単なる事業拡大ではなく、既存事業を活かした「進化」であることを論理的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  market_analysis: (profile, context) =>
    `あなたは中小企業診断士として、中小企業新事業進出補助金の事業計画書の「市場分析と競合優位性」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 進出する市場の規模・成長性・トレンドを示す（可能であれば数値・データを引用）
2. ターゲット顧客層とそのニーズ・課題を具体的に記述する
3. 競合他社の状況（直接・間接競合）と自社の優位点を比較分析する
4. 新市場での勝機・チャンスを論理的に説明する
5. 参入障壁と自社の対応方策に触れる
6. 600-800字程度で記述する

## 審査のポイント
市場の実在性と成長可能性の根拠が求められます。市場調査データ・業界統計・政府資料等を引用し、「なぜこの市場でなければならないか」を客観的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  implementation_structure: (profile, context) =>
    `あなたは中小企業診断士として、中小企業新事業進出補助金の事業計画書の「実施体制と推進計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 新事業の推進体制（責任者・担当部門・必要な人材）を明確にする
2. 外部連携先（認定支援機関・専門家・業務委託先等）の役割を説明する
3. 補助事業期間中のマイルストーンを含む実施スケジュールを記述する
4. 設備投資・人材採用・販路開拓等の主要アクションのタイミングを示す
5. 500-700字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  financial_projection: (profile, context) =>
    `あなたは中小企業診断士として、中小企業新事業進出補助金の事業計画書の「収支計画と事業効果」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 新事業の売上・利益計画を3〜5年分、年度別に示す
2. 付加価値額の増加計画と算出根拠を記述する
3. 投資回収計画（初期投資の回収見込み時期）を明示する
4. 既存事業全体への波及効果（シナジー）を記載する
5. 数値の根拠（想定客単価・受注件数・市場シェア等）を示す
6. 400-600字程度で記述する

## 審査のポイント
収支計画の「現実性」が厳しく評価されます。楽観的な数値だけでなく、保守的シナリオと根拠を示し、審査員が「実現可能だ」と判断できる計画にしてください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  risk_measures: (profile, context) =>
    `あなたは中小企業診断士として、中小企業新事業進出補助金の事業計画書の「リスクと対応策」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 新事業進出における主要リスクを3〜5点列挙する（市場・技術・資金・人材・競合等）
2. 各リスクの発生可能性と影響度を簡潔に示す
3. 各リスクへの具体的な対応策・軽減策を記述する
4. リスクを認識した上でも新事業進出を推進する根拠を示す
5. 300-500字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};

export function getShinjiyoShinshutsuPrompt(
  sectionKey: string,
  profile: BusinessProfile,
  additionalContext?: string
): string {
  const builder = PROMPTS[sectionKey];
  if (!builder) {
    throw new Error(`Unknown shinjigyo-shinshutsu section key: ${sectionKey}`);
  }
  return builder(profile, additionalContext);
}
