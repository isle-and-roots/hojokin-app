import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<
  string,
  (profile: BusinessProfile, context?: string) => string
> = {
  company_overview: (profile, context) =>
    `あなたは中小企業診断士として、中小企業成長加速化補助金の事業計画書の「企業概要と現在の事業状況」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 事業内容、主要製品・サービス、業界内ポジションを具体的に記述する
2. 直近3年の業績推移（売上高・利益率・従業員数）と成長軌跡を示す
3. 技術力・ブランド力・顧客基盤など成長の基盤となる強みを明確にする
4. これまでの成長実績（受賞歴・特許・認証等）があれば記載する
5. 500-700字程度で記述する

## 審査のポイント
成長加速化補助金では「過去の成長実績と将来の成長ポテンシャル」が評価されます。成長意欲だけでなく、既に成長している事実（過去3年の業績改善、顧客数増加等）を具体的数値で示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  growth_strategy: (profile, context) =>
    `あなたは中小企業診断士として、中小企業成長加速化補助金の事業計画書の「成長戦略と目指す姿」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 5年後に目指す企業の姿（ビジョン）を明確に描く
2. 成長戦略の全体像（どの市場でどのように戦うか）を論理的に説明する
3. 市場機会の特定（追い風となるトレンド・政策・社会変化）に触れる
4. 競合との差別化戦略（コスト・品質・スピード・顧客関係等）を示す
5. 今回の投資が成長戦略においてどう位置づけられるかを明示する
6. 800-1200字程度で記述する

## 審査のポイント
成長戦略の「一貫性と説得力」が最重要評価ポイントです。「なぜ今このタイミングで大規模投資が必要か」「なぜ自社がこの市場で勝てるか」を論理的かつ熱意をもって示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  investment_plan: (profile, context) =>
    `あなたは中小企業診断士として、中小企業成長加速化補助金の事業計画書の「投資計画の詳細」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 投資の全体像（設備・システム・人材・販路開拓等の構成）を示す
2. 各投資項目について目的・金額・導入時期を明記する
3. 各投資項目間の相互連携と相乗効果を説明する（なぜ複合投資が必要か）
4. 投資の選定理由（他の選択肢との比較検討結果）を示す
5. 補助対象経費と自己負担の内訳を明確にする
6. 800-1000字程度で記述する

## 審査のポイント
「投資の必要性・妥当性と相乗効果」が評価されます。個々の投資が独立しているのではなく、成長戦略を実現するために一体となって機能することを示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  kpi_targets: (profile, context) =>
    `あなたは中小企業診断士として、中小企業成長加速化補助金の事業計画書の「KPI設定と目標達成計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 以下のKPIを必ず含め、年度別目標値を設定する:
   - 売上高（年次）
   - 付加価値額（営業利益 + 人件費 + 減価償却費）
   - 従業員数
   - 賃金水準（事業場内最低賃金）
2. 追加KPI（新規顧客数・市場シェア・生産性指標等）を2〜3設定する
3. 各KPIの目標値の根拠（算出方法・前提条件）を説明する
4. 目標達成に向けた年度別アクションプランを記述する
5. 600-800字程度で記述する

## 審査のポイント
KPIの「具体性・根拠・挑戦性」が評価されます。現状から乖離した非現実的な目標や、根拠のない数値は評価が下がります。現状の延長線上を超えた「加速」を示しつつ、実現可能性も担保した目標を設定してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  implementation_structure: (profile, context) =>
    `あなたは中小企業診断士として、中小企業成長加速化補助金の事業計画書の「実施体制と推進マネジメント」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 成長加速化プロジェクトの推進体制（プロジェクトオーナー・担当部門・担当者）を示す
2. 経営トップのコミットメントと推進姿勢を明記する
3. 外部専門家・認定支援機関・コンサルタント等との連携体制を説明する
4. 大規模・複合投資を管理するためのPDCAサイクルとモニタリング方法を記述する
5. 400-600字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  financial_projection: (profile, context) =>
    `あなたは中小企業診断士として、中小企業成長加速化補助金の事業計画書の「収支計画と投資回収」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 5年間の売上高・営業利益・付加価値額の推移を年度別に示す
2. 今回の投資（補助事業）による増分効果（補助なしシナリオとの差）を明示する
3. 投資回収期間の見通しを示す（初期投資の回収完了予定時期）
4. 資金計画（自己資金・借入・補助金の活用バランス）に触れる
5. 数値の根拠（想定顧客単価・受注件数増加・コスト削減額等）を具体的に説明する
6. 500-700字程度で記述する

## 審査のポイント
「中長期の収益性と財務的持続可能性」が審査されます。補助金頼みではなく、自立的な成長が見込める財務計画であることを示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};

export function getSeichouKasokukaPrompt(
  sectionKey: string,
  profile: BusinessProfile,
  additionalContext?: string
): string {
  const builder = PROMPTS[sectionKey];
  if (!builder) {
    throw new Error(`Unknown seichou-kasokuka section key: ${sectionKey}`);
  }
  return builder(profile, additionalContext);
}
