import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<string, (profile: BusinessProfile, context?: string) => string> = {
  company_overview: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「企業の概要」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 事業内容、主要製品・サービス、主要取引先を具体的に記述する
2. 技術力・開発力がわかるエピソードや実績を含める
3. 組織体制（従業員構成、技術者比率等）を簡潔に示す
4. 業界内でのポジション・市場シェアに言及する
5. 直近の業績推移（売上高・利益の増減傾向）を記載する
6. 600-800字程度で記述する

## 審査のポイント
ものづくり補助金の審査では「技術面」と「事業化面」が重視されます。企業概要では自社の技術的基盤と事業展開力を印象づけてください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  innovation_content: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「革新的な取組の内容」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 開発する製品・サービス・生産プロセスの「革新性」を明確に示す
2. 既存技術・既存製品との違いを具体的に比較する
3. 技術的な課題と解決方法を論理的に記述する
4. 顧客のどのようなニーズに応えるのかを明示する
5. 市場における競合製品との差別化ポイントを説明する
6. 導入する設備・システムの仕様と選定理由を記載する
7. 1000-1500字程度で記述する

## 審査のポイント
「革新性」の審査では、①製品・サービスの新規性、②市場におけるニーズの妥当性、③技術面の実現可能性が評価されます。単なる設備更新ではなく、付加価値を生む取り組みであることを強調してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  implementation_plan: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「実施体制とスケジュール」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 事業の実施体制を明確にする（責任者、担当者、外部連携先の役割）
2. 月単位のスケジュールを示す（設備発注→納品→設置→試運転→本稼働）
3. 各工程でのマイルストーンと成果物を記載する
4. 外部専門家・連携機関がある場合はその役割と連携方法を説明する
5. リスク要因と対策を1-2点示す
6. 600-800字程度で記述する

## 審査のポイント
「実現可能性」の評価では、実施体制の妥当性とスケジュールの具体性が問われます。補助事業期間（通常10か月）内に確実に完了できる計画であることを示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  productivity_improvement: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「生産性向上の具体的方策」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 現在の生産プロセスの課題（ボトルネック、非効率な工程）を具体的に示す
2. 設備投資によってどの工程がどう改善されるかを数値で示す
3. 改善前後の比較（生産量、リードタイム、不良率、人件費等）を含める
4. 付加価値額の増加計画（年率3%以上）の根拠を論理的に説明する
5. 給与支給総額の増加計画（年率1.5%以上）との関連を示す
6. 600-800字程度で記述する

## 審査のポイント
ものづくり補助金の交付要件として「付加価値額年率3%以上」「給与支給総額年率1.5%以上」の増加が求められます。この数値目標を達成する道筋を具体的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  financial_projection: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「将来の事業計画と数値目標」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 3〜5年間の数値計画を年度ごとに示す
2. 以下のKPIを必ず含める:
   - 付加価値額（営業利益 + 人件費 + 減価償却費）: 年率3%以上増加
   - 給与支給総額: 年率1.5%以上増加
   - 事業場内最低賃金: 地域別最低賃金＋30円以上
3. 売上高、営業利益、経常利益の推移も記載する
4. 数値の根拠（受注見込み、新規顧客数、単価向上等）を示す
5. 400-600字程度で記述する（数値表は別途作成を推奨）

## 審査のポイント
数値計画の妥当性と実現可能性が審査されます。楽観的すぎる計画は逆効果です。現実的かつ成長性のある計画を示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  digital_innovation: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金（デジタル枠）の事業計画書の「デジタル技術を活用した革新的取り組み」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 活用するデジタル技術（AI、IoT、クラウド、ロボティクス等）の内容と選定理由を具体的に示す
2. そのデジタル技術による革新性（既存手法との差異）を明確にする
3. デジタル技術の活用がどのように生産性向上・付加価値向上に貢献するかを論理的に説明する
4. DXに資する取り組みであることを示す（デジタル枠の審査要件）
5. 技術的な実現可能性の根拠を示す
6. 600〜1000字程度で記述する

## 審査のポイント
デジタル枠では「DXに資するデジタル技術の活用」が必須要件です。単なるデジタルツール導入ではなく、事業変革につながる革新性を強調してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  expected_outcome: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「事業効果」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 設備投資による定量的な効果（生産量増加、リードタイム短縮、不良率低減等）を数値で示す
2. 付加価値額の増加見込み（年率3%以上）の根拠を論理的に説明する
3. 給与支給総額の増加計画（年率1.5%以上）との関連を示す
4. 定性的な効果（品質向上、顧客満足度向上、ブランド力強化等）も記述する
5. 400〜600字程度で記述する

## 審査のポイント
ものづくり補助金の交付要件として「付加価値額年率3%以上」「給与支給総額年率1.5%以上」の増加が求められます。これらの目標を達成する道筋を具体的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  global_strategy: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金（グローバル展開型）の事業計画書の「海外展開戦略」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. ターゲットとする国・地域を明示し、市場規模・成長性・参入可能性を分析する
2. 海外展開の形態（直接投資、越境EC、OEM、現地パートナー等）を具体的に記述する
3. 海外の競合状況と自社の競争優位性・差別化ポイントを説明する
4. 現地ニーズへの対応方法（製品改良、現地化戦略等）を示す
5. 海外展開のリスクと対策を1〜2点示す
6. 600〜800字程度で記述する

## 審査のポイント
グローバル展開型では海外展開の「実現可能性と具体性」が重視されます。既存の海外取引実績や現地パートナーとの連携があれば積極的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  investment_plan: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「設備投資計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 導入する設備・システムの名称・仕様・用途を具体的に記述する
2. 各設備の選定理由（なぜその設備が革新的取り組みに必要か）を説明する
3. 設備導入のスケジュール（発注→納品→設置→試運転→本稼働）を月単位で示す
4. 設備投資の費用内訳（機械装置費、システム構築費等）を明記する
5. 既存設備との関係性（更新か追加か、連携方法等）を示す
6. 600〜800字程度で記述する

## 審査のポイント
設備の革新性と補助事業との関連性が審査されます。「なぜその設備が必要か」「どう革新的取り組みに貢献するか」を具体的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  product_development: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「革新的製品・サービスの開発内容」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 開発する製品・サービスの内容を具体的に記述する（何を・どのように・誰に提供するか）
2. 既存製品・サービスとの違い（革新性・新規性）を明確に比較する
3. 技術的な課題と解決方法を論理的に記述する
4. 顧客・市場ニーズとの対応関係を示す
5. 競合製品との差別化ポイントを説明する
6. 600〜800字程度で記述する（海外市場向けの場合は800〜1200字）

## 審査のポイント
「革新性」の審査では、①製品・サービスの新規性、②市場ニーズとの整合性、③技術面の実現可能性が評価されます。単なる設備更新ではなく、付加価値を生む取り組みであることを強調してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  revenue_projection: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「収益計画と海外売上目標」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 3〜5年間の売上・利益の見込みを年度別に示す（国内・海外別に分けて記述）
2. 海外売上目標の数値と根拠（ターゲット顧客数×単価、市場シェア等）を明示する
3. 付加価値額の年率3%以上増加の達成見込みを具体的な数値で示す
4. 投資回収の見込み時期を明記する
5. 楽観的すぎない堅実な計画を示す
6. 400〜600字程度で記述する

## 審査のポイント
海外売上目標の実現可能性と付加価値額増加計画の妥当性が審査されます。根拠のある数値を示し、グローバル展開型の交付要件を満たす計画であることを明確にしてください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};

export function getMonodzukuriPrompt(
  sectionKey: string,
  profile: BusinessProfile,
  additionalContext?: string
): string {
  const builder = PROMPTS[sectionKey];
  if (!builder) {
    throw new Error(`Unknown monodzukuri section key: ${sectionKey}`);
  }
  return builder(profile, additionalContext);
}
