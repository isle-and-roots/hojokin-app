import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<string, (profile: BusinessProfile, context?: string) => string> = {
  company_overview: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「企業の概要」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 事業内容、主要製品・サービス、主要取引先を具体的に記述する
2. 技術力・開発力がわかるエピソードや実績を含める
3. 組織体制（従業員構成、技術者比率等）を簡潔に示す
4. 業界内でのポジション・市場シェアに言及する
5. 直近の業績推移（売上高・利益の増減傾向）を記載する
6. 600-800字程度で記述する

## 審査のポイント
ものづくり補助金の審査では「技術面」と「事業化面」が重視されます。企業概要では自社の技術的基盤と事業展開力を印象づけてください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  innovation_content: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「革新的な取組の内容」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 開発する製品・サービス・生産プロセスの「革新性」を明確に示す
2. 既存技術・既存製品との違いを具体的に比較する
3. 技術的な課題と解決方法を論理的に記述する
4. 顧客のどのようなニーズに応えるのかを明示する
5. 市場における競合製品との差別化ポイントを説明する
6. 導入する設備・システムの仕様と選定理由を記載する
7. 1000-1500字程度で記述する

## 審査のポイント
「革新性」の審査では、①製品・サービスの新規性、②市場におけるニーズの妥当性、③技術面の実現可能性が評価されます。単なる設備更新ではなく、付加価値を生む取り組みであることを強調してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  implementation_plan: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「実施体制とスケジュール」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 事業の実施体制を明確にする（責任者、担当者、外部連携先の役割）
2. 月単位のスケジュールを示す（設備発注→納品→設置→試運転→本稼働）
3. 各工程でのマイルストーンと成果物を記載する
4. 外部専門家・連携機関がある場合はその役割と連携方法を説明する
5. リスク要因と対策を1-2点示す
6. 600-800字程度で記述する

## 審査のポイント
「実現可能性」の評価では、実施体制の妥当性とスケジュールの具体性が問われます。補助事業期間（通常10か月）内に確実に完了できる計画であることを示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  productivity_improvement: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「生産性向上の具体的方策」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 現在の生産プロセスの課題（ボトルネック、非効率な工程）を具体的に示す
2. 設備投資によってどの工程がどう改善されるかを数値で示す
3. 改善前後の比較（生産量、リードタイム、不良率、人件費等）を含める
4. 付加価値額の増加計画（年率3%以上）の根拠を論理的に説明する
5. 給与支給総額の増加計画（年率1.5%以上）との関連を示す
6. 600-800字程度で記述する

## 審査のポイント
ものづくり補助金の交付要件として「付加価値額年率3%以上」「給与支給総額年率1.5%以上」の増加が求められます。この数値目標を達成する道筋を具体的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  financial_projection: (profile, context) => `あなたは中小企業診断士として、ものづくり・商業・サービス生産性向上促進補助金の事業計画書の「将来の事業計画と数値目標」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 3〜5年間の数値計画を年度ごとに示す
2. 以下のKPIを必ず含める:
   - 付加価値額（営業利益 + 人件費 + 減価償却費）: 年率3%以上増加
   - 給与支給総額: 年率1.5%以上増加
   - 事業場内最低賃金: 地域別最低賃金＋30円以上
3. 売上高、営業利益、経常利益の推移も記載する
4. 数値の根拠（受注見込み、新規顧客数、単価向上等）を示す
5. 400-600字程度で記述する（数値表は別途作成を推奨）

## 審査のポイント
数値計画の妥当性と実現可能性が審査されます。楽観的すぎる計画は逆効果です。現実的かつ成長性のある計画を示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};

export function getMonodzukuriPrompt(
  sectionKey: string,
  profile: BusinessProfile,
  additionalContext?: string
): string {
  const builder = PROMPTS[sectionKey];
  if (!builder) {
    throw new Error(`Unknown monodzukuri section key: ${sectionKey}`);
  }
  return builder(profile, additionalContext);
}
