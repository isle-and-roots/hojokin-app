import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<
  string,
  (profile: BusinessProfile, context?: string) => string
> = {
  company_profile: (profile, context) =>
    `あなたは中小企業診断士として、事業再構築補助金の事業計画書の「事業者の概要」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 会社の沿革を簡潔にまとめ、事業の信頼性を示す
2. 現在の主力事業・製品・サービスの内容を具体的に記述する
3. 組織体制（従業員数、部門構成、主要人材の専門性）を示す
4. 主な取引先・顧客層を明記し、事業基盤の安定性を示す
5. 既存事業で培った技術力・ノウハウを強調する
6. 800〜1000字程度で記述する

## 審査のポイント
事業再構築補助金では、既存事業の基盤がしっかりしていることが前提です。審査員が「この事業者なら新事業にも取り組める」と判断できるよう、既存事業の実績と経営資源を具体的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  current_situation: (profile, context) =>
    `あなたは中小企業診断士として、事業再構築補助金の事業計画書の「事業の現状と課題」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 現在の事業環境の変化（市場縮小、競争激化、コロナ影響等）を客観的データで示す
2. 売上・利益の推移を具体的な数値で記述する（直近3〜5年）
3. 既存事業の構造的な課題を明確にする（単なる売上減少ではなく根本原因を分析）
4. なぜ事業再構築が必要なのか、現状維持では解決できない理由を論理的に説明する
5. 業界全体のトレンドと自社への影響を分析する
6. 1000〜1500字程度で記述する

## 審査のポイント
「コロナの影響で売上が減った」だけでは不十分です。事業環境の構造的変化を分析し、既存事業の延長線上では成長が困難であることを、データと論理で説得力をもって示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  restructuring_plan: (profile, context) =>
    `あなたは中小企業診断士として、事業再構築補助金の事業計画書の「事業再構築の具体的内容」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 事業再構築の類型（新分野展開・業態転換・事業転換・業種転換・事業再編）を明確にする
2. 新事業の具体的な内容（何を・誰に・どのように提供するか）を詳細に記述する
3. 既存事業との関連性・シナジー効果を説明する
4. 実施体制（担当者、外部パートナー、必要な人材確保計画）を示す
5. 実施スケジュール（月単位）を具体的に記載する
6. 必要な設備・システム投資の内容と金額を明記する
7. 事業再構築指針に沿った取り組みであることを明示する
8. 認定経営革新等支援機関との連携体制に触れる
9. 2000〜3000字程度で記述する

## 審査のポイント
事業再構築補助金の最重要セクションです。「事業再構築指針」への適合性、事業化の見込み、補助事業の妥当性が厳しく審査されます。新事業が既存事業と明確に異なること、かつ既存の経営資源を活かせることを両立して示してください。スケジュールは現実的な粒度で記載し、各工程の担当と達成基準を明確にしてください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  market_analysis: (profile, context) =>
    `あなたは中小企業診断士として、事業再構築補助金の事業計画書の「市場分析・競合分析」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 参入する市場の規模（TAM/SAM/SOM）を可能な限り数値で示す
2. 市場の成長性・将来性を公的データや業界レポートに基づいて分析する
3. 主要な競合他社（3〜5社）を挙げ、各社の強み・弱みを比較する
4. 自社の差別化ポイント・競争優位性を明確にする
5. ターゲット顧客のニーズ・ペインポイントを具体的に記述する
6. 参入障壁と対策を分析する
7. 800〜1200字程度で記述する

## 審査のポイント
市場の魅力度（十分な規模と成長性）と、自社が競争に勝てる根拠の両方が必要です。「市場が伸びている」だけでなく、なぜ自社がその市場で成功できるのかを具体的に示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  financial_plan: (profile, context) =>
    `あなたは中小企業診断士として、事業再構築補助金の事業計画書の「収支計画・資金計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 補助事業期間中の収支見込み（売上・原価・経費・利益）を年度別に示す
2. 事業終了後3〜5年の収支計画を記載する
3. 付加価値額の年率平均3.0%以上増加の達成見込みを具体的な数値で示す
4. 補助金の使途内訳（建物費、機械装置費、システム構築費等）を明記する
5. 自己資金・借入等の資金調達計画を示す
6. 投資回収の見込み時期を明記する
7. 600〜800字程度で記述する

## 審査のポイント
数値計画の実現可能性が重視されます。売上見込みの根拠（顧客数×単価、市場シェア等）を明示し、楽観的すぎない堅実な計画を示してください。付加価値額の増加目標は必須要件です。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};

export function getJigyouSaikouchikuPrompt(
  sectionKey: string,
  profile: BusinessProfile,
  additionalContext?: string
): string {
  const builder = PROMPTS[sectionKey];
  if (!builder) {
    throw new Error(`Unknown jigyou-saikouchiku section key: ${sectionKey}`);
  }
  return builder(profile, additionalContext);
}
