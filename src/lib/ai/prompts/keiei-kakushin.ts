import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<
  string,
  (profile: BusinessProfile, context?: string) => string
> = {
  // ============================================================
  // 東京都 創業助成事業 (tokyo-sougyou-001)
  // ============================================================
  business_idea: (profile, context) =>
    `あなたは中小企業診断士として、東京都創業助成事業の事業計画書の「ビジネスプラン概要」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 創業するビジネスの全体像（何を、誰に、どのように提供するか）を明確に記述する
2. 提供する商品・サービスの具体的な内容と特徴・差別化ポイントを説明する
3. 既存の解決手段と比較した優位性・新規性を示す
4. ビジネスモデル（収益の仕組み、マネタイズ方法）を具体的に説明する
5. 創業者・事業者の強み（業界経験、技術力、人脈等）を記述する
6. 事業の社会的意義・社会課題解決への貢献があれば記載する
7. 600〜800字程度で記述する

## 審査のポイント
東京都創業助成事業では、ビジネスプランの具体性と実現可能性が重視されます。「何となく面白そう」ではなく、市場ニーズの裏付けと収益化の具体的な道筋を示してください。創業者の経験・スキルが事業成功に直結することを明確にすることが重要です。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  target_market: (profile, context) =>
    `あなたは中小企業診断士として、東京都創業助成事業の事業計画書の「市場分析とターゲット顧客」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 参入する市場の規模（TAM/SAM/SOM）を可能な限り数値で示す
2. 市場の成長トレンドと将来性を説明する
3. ターゲット顧客を具体的なペルソナとして描写する（属性、ニーズ、行動パターン等）
4. ターゲット顧客の抱えるペインポイントと自社サービスによる解決を示す
5. 主要な競合他社（3社程度）の強み・弱みを分析する
6. 競合との差別化ポイントと自社の競争優位性を明確にする
7. 400〜600字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  marketing_strategy: (profile, context) =>
    `あなたは中小企業診断士として、東京都創業助成事業の事業計画書の「マーケティング・販売戦略」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 集客・認知獲得の具体的な方法（SNS、SEO、展示会、紹介等）とその理由を記述する
2. 販売チャネル（オンライン、直販、代理店等）の選択理由と展開計画を示す
3. 価格戦略（価格設定の根拠、競合比較）を説明する
4. 初期顧客獲得の具体的なアクションプランを示す
5. 顧客獲得コスト（CAC）と顧客生涯価値（LTV）のバランスに触れる
6. 開業後の口コミ・紹介獲得の仕組みを記述する
7. 400〜600字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  revenue_plan: (profile, context) =>
    `あなたは中小企業診断士として、東京都創業助成事業の事業計画書の「売上計画・資金計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 月次・年次の売上見込みを根拠とともに示す（顧客数×単価×継続率等の積算根拠を明記）
2. 損益計算書の見通し（売上高・原価・粗利・経費・営業利益）を開業後3年分示す
3. 必要な初期投資額とその内訳を記載する（設備・広告・運転資金等）
4. 資金調達の方法（自己資金、融資、助成金等）と金額を示す
5. キャッシュフロー上の課題（資金ショートのリスク）と対応策を記述する
6. 損益分岐点（BEP）に達する見込み時期を示す
7. 400〜600字程度で記述する

## 審査のポイント
売上計画は根拠のない楽観的な数値ではなく、現実的かつ保守的な積算根拠を示してください。助成金の使途（何にいくら使うか）と、助成期間終了後の自走可能性を明確にすることが重要です。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  // ============================================================
  // 経営革新計画 (keiei-kakushin-001)
  // ============================================================
  new_business_content: (profile, context) =>
    `あなたは中小企業診断士として、経営革新計画承認申請書の「新事業活動の内容」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 実施する新事業活動の類型を明確にする（新商品の開発・生産、新サービスの開発・提供、新たな生産・販売方式の導入等）
2. 新事業活動の具体的な内容を詳細に記述する（何を、どのように、誰に提供するか）
3. 既存事業と比較した新規性・革新性を明確にする
4. 経営革新計画法の要件（「新事業活動」として認定される新規性）を満たしていることを示す
5. 既存の経営資源（技術、ノウハウ、顧客基盤、設備等）をどう活用するかを説明する
6. 計画期間（3〜5年）における段階的な展開計画を示す
7. 600〜800字程度で記述する

## 審査のポイント
経営革新計画では「新事業活動」であることの認定が重要です。単なる設備更新や既存事業の量的拡大ではなく、自社にとって明確な新規性・革新性があることを示してください。業界で見て目新しくなくても、自社にとっての新規性が認められれば対象となります。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  implementation_plan: (profile, context) =>
    `あなたは中小企業診断士として、経営革新計画承認申請書の「実施計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 新事業活動の実施体制（責任者、担当部署、外部パートナー等）を具体的に示す
2. 実施スケジュール（計画期間3〜5年の年次計画）を時系列で記載する
3. 必要な設備・システム投資の内容と導入時期を記載する
4. 人材確保・育成計画（採用計画、社員研修等）を示す
5. 必要な資金の調達計画（自己資金、融資、補助金等の活用）を記述する
6. リスク要因と対応策（市場リスク、技術リスク等）に触れる
7. 400〜600字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  management_targets: (profile, context) =>
    `あなたは中小企業診断士として、経営革新計画承認申請書の「経営目標」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 付加価値額の計画期間における年率平均3%以上の向上目標を具体的な数値で示す
2. 経常利益の年率平均1%以上向上の目標を数値で示す（付加価値額目標を達成できない場合）
3. 売上高・付加価値額・経常利益の計画期間末における目標値を現状値と比較して示す
4. 目標達成の根拠（売上増加の要因、コスト削減の方法等）を簡潔に説明する
5. 従業員数や設備投資額等の副次的な指標があれば記載する
6. 300〜400字程度で記述する

## 審査のポイント
付加価値額（営業利益＋人件費＋減価償却費）の年率平均3%以上の向上は必須要件です。計画期間を3年とする場合は3年後に現状比約9%以上の向上が必要です。数値は現実的な範囲で設定し、達成の根拠を明確にしてください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  // ============================================================
  // 東京都DX推進助成金 (it-digital-010)
  // ============================================================
  business_overview: (profile, context) =>
    `あなたは中小企業診断士として、東京都中小企業DX推進支援事業助成金申請書の「企業概要」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 企業の基本情報（設立年、資本金、従業員数、売上規模）を簡潔に示す
2. 主力事業・製品・サービスの内容を具体的に説明する
3. 主な取引先・顧客層と市場での位置づけを記述する
4. 現在のIT・デジタル活用状況（使用しているシステム、デジタル化の進捗）を示す
5. 東京都内での事業展開状況と地域経済への貢献を記載する
6. DX推進に取り組む背景・動機（経営課題、競合環境の変化等）に触れる
7. 300〜500字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  dx_strategy: (profile, context) =>
    `あなたは中小企業診断士として、東京都中小企業DX推進支援事業助成金申請書の「DX推進戦略」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. DX推進によって解決する経営課題・業務上の課題を具体的に記述する
2. 導入・開発するシステム・ツールの内容と機能を詳細に説明する
3. 現状の業務フロー（As-Is）とDX推進後の業務フロー（To-Be）を比較して示す
4. DX推進の実施体制（担当者、外部ベンダーの活用、プロジェクト体制）を記載する
5. 実施スケジュール（要件定義→開発→テスト→本番稼働→定着化の各フェーズ）を示す
6. セキュリティ対策・情報管理体制についても触れる
7. 全社的なDXへの取り組み意識醸成・従業員教育の計画を記述する
8. 500〜800字程度で記述する

## 審査のポイント
東京都DX推進助成金では、単なるツール導入ではなく「デジタル技術を活用した業務変革」であることが求められます。システム導入後の業務変革・生産性向上の具体的なシナリオを示し、全社的な取り組みであることをアピールしてください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  expected_outcome: (profile, context) =>
    `あなたは中小企業診断士として、東京都中小企業DX推進支援事業助成金申請書の「期待される成果」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. DX推進により期待される定量的な効果を具体的な数値で示す（作業時間削減率、コスト削減額、売上向上額等）
2. 業務効率化・生産性向上の効果を従業員への影響も含めて記述する
3. 顧客サービス向上・顧客満足度への効果を記述する
4. 売上・利益への貢献（新規顧客獲得、既存顧客の単価向上等）を示す
5. 助成事業終了後の自社でのDX推進継続計画を記載する
6. 都内中小企業へのモデルケースとしての波及効果があれば触れる
7. 300〜500字程度で記述する

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  // ============================================================
  // SBIR推進プログラム (sbir-001)
  // ============================================================
  research_theme: (profile, context) =>
    `あなたは中小企業診断士として、SBIR推進プログラム申請書の「研究開発テーマと技術シーズ」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 取り組む研究開発テーマを明確に定義し、政府が提示したSBIR指定テーマとの関連性を示す
2. 自社が保有する技術シーズ（基礎技術、知的財産、独自ノウハウ）を具体的に説明する
3. 技術の革新性・優位性（既存技術との比較、新規性の根拠）を記述する
4. 解決しようとする社会課題・産業課題とその重要性を説明する
5. 技術開発の現在のTRL（技術成熟度）と目標とするTRLを示す
6. 研究開発チームの専門性・研究実績（特許、論文、受賞歴等）を記載する
7. 大学・研究機関等との連携がある場合はその内容も説明する
8. 600〜800字程度で記述する

## 審査のポイント
SBIRでは政府が設定したテーマとの適合性と、自社技術シーズの独自性・優位性が重視されます。「なぜ自社がこの技術を開発できるのか」という根拠を明確にし、既存の市販技術との差別化を技術的根拠とともに示してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  research_plan: (profile, context) =>
    `あなたは中小企業診断士として、SBIR推進プログラム申請書の「研究開発計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 研究開発の全体像とフェーズ構成（フェーズ1：FS、フェーズ2：研究開発、フェーズ3：実証・事業化）を示す
2. 当該申請フェーズにおける具体的な研究開発内容・実施項目を詳細に記述する
3. 研究開発の実施体制（社内研究者、外部研究機関、産学連携等）を明記する
4. 詳細なマイルストーン・スケジュール（月単位）を記載する
5. 各研究開発項目の達成目標と評価指標（KPI）を数値で示す
6. 実験・検証の方法論、使用する設備・機器を説明する
7. 想定されるリスクと技術的な対応策を示す
8. 研究開発費用の積算根拠（人件費、設備費、外注費等の内訳）を記載する
9. 成果物の知的財産化方針（特許出願、秘匿化等）に触れる
10. 800〜1200字程度で記述する

## 審査のポイント
研究開発計画の実現可能性が最も重視されます。スケジュールの妥当性、体制の充実度、マイルストーンの具体性を示してください。達成基準が曖昧だと評価が下がるため、定量的な評価指標（達成率、性能指標等）を明確に設定してください。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,

  commercialization: (profile, context) =>
    `あなたは中小企業診断士として、SBIR推進プログラム申請書の「事業化計画」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}
## 作成ルール
1. 研究開発成果の事業化シナリオ（製品化・サービス化の具体的な姿）を詳細に記述する
2. ターゲット市場の規模と成長性、ターゲット顧客を具体的に示す
3. 事業化後の収益モデル（製品販売、ライセンス供与、サービス提供等）を説明する
4. 事業化に向けたロードマップ（研究開発完了から上市・本格販売までの時系列）を示す
5. 想定する競合製品・技術との比較における優位性を示す
6. 事業化後5年間の売上・利益計画を示す
7. 社会実装による社会課題解決のインパクト（環境負荷低減、生産性向上等の定量的効果）を記述する
8. 自社単独での事業化が困難な場合、パートナー企業との連携計画を示す
9. 600〜800字程度で記述する

## 審査のポイント
SBIRは研究開発から事業化までの一貫支援が目的です。「優れた技術があれば売れる」という技術プッシュ型の計画ではなく、市場ニーズとのマッチングと収益化の明確な道筋を示してください。社会実装による定量的な社会課題解決効果も重要な評価ポイントです。

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};

export function getKeieiKakushinPrompt(
  sectionKey: string,
  profile: BusinessProfile,
  additionalContext?: string
): string {
  const builder = PROMPTS[sectionKey];
  if (!builder) {
    throw new Error(`Unknown keiei-kakushin section key: ${sectionKey}`);
  }
  return builder(profile, additionalContext);
}
