# AI プロンプト品質ガイドライン

## 概要
hojokin-app の AI 生成品質は、ユーザーの補助金採択率に直結するビジネスクリティカルな要素。
プロンプトの改善は収益に直接貢献する最重要タスクの一つ。

---

## プロンプト設計原則

### 1. ペルソナの統一
- 全プロンプトで「中小企業診断士」をペルソナとして使用
- 補助金審査の経験がある専門家として振る舞う
- 審査員の視点を意識した記述を指示する

### 2. 事業者情報の最大活用
`profileContext()` で提供される情報を全て活用する:
```
会社名、代表者名、住所、電話、メール、業種、
従業員数、年商、設立年、事業概要、
取扱商品・サービス、ターゲット顧客、
販売チャネル、強み、課題
```
- `[要入力: ○○]` は情報が本当に不足している場合のみ使用
- プロフィール情報から推測可能な内容は AI が補完する

### 3. 文字数の厳守
各セクションの目安文字数を必ずプロンプトに含める:
- 短いセクション: 300-500字
- 標準セクション: 800-1200字
- 長いセクション: 1000-1500字
- 文字数オーバーは減点リスクがあるため、上限を厳守

### 4. 出力形式の統一
- **プレーンテキスト**（マークダウン不使用）
- 箇条書きと文章を組み合わせて読みやすくする
- 審査員が読む書類であることを意識

---

## 品質チェックリスト（新プロンプト作成時）

| # | チェック項目 | 基準 |
|---|------------|------|
| 1 | ペルソナ指定 | 「中小企業診断士として」が含まれている |
| 2 | 事業者情報セクション | `profileContext(profile)` が含まれている |
| 3 | 追加情報セクション | `additionalContext` が含まれている |
| 4 | 文字数ガイド | 目安文字数が明記されている |
| 5 | 審査員目線の指示 | 審査基準を意識した記述指示がある |
| 6 | 具体性の指示 | 数字・データの使用が指示されている |
| 7 | 出力形式 | プレーンテキスト出力が指示されている |
| 8 | 不足情報の処理 | `[要入力: ○○]` の指示がある |
| 9 | 虚偽データ防止 | 架空の数値を生成しない指示がある |
| 10 | 補助金要件の参照 | 補助金の趣旨・要件に沿う指示がある |

---

## 補助金別プロンプト対応状況

### FULL 対応（カスタムプロンプト）
| 補助金 | ファイル | セクション数 | 品質 |
|--------|---------|------------|------|
| 持続化補助金（一般型） | `jizokuka.ts` | 8 | A |

### GENERIC 対応（汎用プロンプト）
| 補助金 | セクション数 | 品質 |
|--------|------------|------|
| IT導入補助金 | 定義による | B |
| 事業再構築補助金 | 定義による | B |
| ものづくり補助金 | 定義による | B |
| その他11件 | 定義による | B-C |

### 品質評価基準
| ランク | 基準 |
|--------|------|
| A | カスタムプロンプト、審査基準に最適化、具体的な指示 |
| B | 汎用プロンプトだが補助金の概要・要件を参照 |
| C | 最低限の汎用プロンプトのみ |

### 品質向上ロードマップ
1. **最優先**: IT導入補助金を FULL 対応に（利用者が多い）
2. **次点**: ものづくり補助金を FULL 対応に（金額が大きく訴求力高い）
3. **順次**: 利用頻度の高い補助金から FULL 対応化

---

## FULL 対応プロンプトのテンプレート

新しい補助金を FULL 対応にする際のテンプレート:

```typescript
// src/lib/ai/prompts/{subsidy_id}.ts

import type { BusinessProfile } from "@/types";
import { profileContext } from "./shared";

const PROMPTS: Record<string, (profile: BusinessProfile, context?: string) => string> = {
  section_key: (profile, context) => `あなたは中小企業診断士として、「{補助金名}」の{書類名}の「{セクション名}」セクションを作成してください。

## 事業者情報
${profileContext(profile)}

${context ? `## 追加情報\n${context}\n` : ""}

## この補助金の審査ポイント
{審査で重視されるポイントを列挙}

## 作成ルール
1. {補助金固有のルール1}
2. {補助金固有のルール2}
3. 具体的な数字を可能な限り含める
4. {目安文字数}字程度で記述する
5. 箇条書きと文章を組み合わせて読みやすくする

## 出力形式
セクション本文をそのまま出力してください（マークダウン書式は使用しない、プレーンテキスト）。
情報が不足している箇所は [要入力: ○○] と明示してください。`,
};
```

---

## 生成品質の測定方法

### 定量指標
1. **文字数適合率**: 指定文字数範囲内に収まっている割合
2. **要入力箇所数**: `[要入力: ○○]` の平均出現回数（少ないほど良い）
3. **生成成功率**: エラーなく生成完了する割合（目標: 95%以上）
4. **ユーザー編集率**: AI 生成後にユーザーが編集する割合（低いほど品質が高い）

### 定性指標（人手レビュー）
1. **審査基準との整合性**: 補助金の審査ポイントを押さえているか
2. **具体性**: 事業者固有の情報が反映されているか
3. **論理構成**: セクション間の一貫性があるか
4. **読みやすさ**: 審査員が短時間で内容を理解できるか

---

## 禁止事項

1. **架空の統計データの生成指示は禁止**
   - NG: 「業界の市場規模を○○億円として記述」
   - OK: 「業界の市場動向について一般的な傾向を記述」

2. **虚偽の事業実績の記述は禁止**
   - NG: 「売上が前年比150%成長したと記述」
   - OK: 「プロフィールの売上データに基づいて成長率を記述」

3. **補助金要件を満たさない申請書の生成は禁止**
   - プロフィール情報から明らかに要件を満たさない場合は警告

4. **他の採択事例のコピーは禁止**
   - 採択事例を参考にしつつ、事業者固有の内容を生成
